{% extends "base.html" %}

{% block style %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='style/aboutus.css') }}"
/>
{% endblock %}

{% block content %}
<section class="about-section">
  <div class="about-us-container">
    <h2>Top 5 Popular Dishes</h2>
    <ol class="popular-dishes-list" id="top-dishes"></ol>
  </div>
</section>

<section class="about-section">
  <div class="about-us-container">
    <h2>Top 5 Popular Ingredients</h2>
    <ol class="popular-ingredients-list" id="top-ingredients"></ol>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    const res = await fetch("{{ url_for('insight.insight_api') }}", {
      method: "POST"
    });
    if (!res.ok) throw new Error("Failed to load stats");

    const { top_dishes, top_ingredients } = await res.json();

    renderList(
      document.getElementById("top-dishes"),
      top_dishes,
      "dishes.food"
    );

    renderList(
      document.getElementById("top-ingredients"),
      top_ingredients,
      "ingredients.ingredientsListController"
    );

  } catch (err) {
    console.error(err);
  }
});

function renderList(container, items, endpoint) {
  container.innerHTML = items.map((item, index) => `
    <li>
      <a href="/${endpoint.includes('dishes') ? 'dishes' : 'ingredients'}/${item.name}">
        ${index + 1}. ${item.name} (${item.korean_name})
      </a>
    </li>
  `).join("");
}
</script>
{% endblock %}
